<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quirino Residence Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #f8fafc;
            --accent-color: #0ea5e9;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
        }
        
        @media (min-width: 768px) {
            body { padding: 20px; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .brand-text {
            color: white;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
        }
        
        .nav-tabs {
            display: flex;
            background: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .nav-tabs::-webkit-scrollbar { display: none; }
        
        .nav-tab {
            flex: 1;
            min-width: max-content;
            padding: 16px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: rgba(37, 99, 235, 0.05);
            color: var(--primary-color);
            transform: translateY(-1px);
        }
        
        .nav-tab.active {
            background: white;
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        @media (min-width: 768px) {
            .tab-content { padding: 30px; }
        }
        
        .tab-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover { transform: translateY(-2px); }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }
        
        .villa-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .villa-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
            min-width: 140px;
        }
        
        .villa-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .villa-btn:hover:not(.active) {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .calendar-container {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 20px 0;
        }
        
        .calendar-header-row {
            display: flex;
            background: var(--primary-color);
            color: white;
        }
        
        .calendar-header {
            flex: 1;
            padding: 16px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border-color);
        }
        
        .calendar-day {
            background: white;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            min-height: 60px;
            padding: 8px 4px;
        }
        
        @media (min-width: 768px) {
            .calendar-day {
                min-height: 80px;
                padding: 12px 8px;
            }
        }
        
        .calendar-day:hover {
            background: var(--secondary-color);
            transform: scale(1.02);
            z-index: 1;
            box-shadow: var(--shadow-md);
        }
        
        .calendar-day.other-month {
            color: var(--text-secondary);
            background: #f8fafc;
        }
        
        .calendar-day.available {
            background: #ecfdf5;
            color: var(--success-color);
            border: 2px solid #bbf7d0;
        }
        
        .calendar-day.booked {
            background: #fef2f2;
            color: var(--danger-color);
            border: 2px solid #fecaca;
        }
        
        .calendar-day.pending {
            background: #fffbeb;
            color: var(--warning-color);
            border: 2px solid #fed7aa;
        }
        
        .day-number {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .booking-info {
            font-size: 10px;
            font-weight: 500;
            text-align: center;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .booking-info {
                font-size: 11px;
                white-space: normal;
                overflow: visible;
            }
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: var(--secondary-color);
            border-radius: 12px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
        }
        
        .month-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        
        .month-nav-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .month-nav-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .current-month {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .bookings-list {
            margin-top: 20px;
            display: grid;
            gap: 20px;
        }
        
        .booking-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .booking-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .booking-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .booking-title {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .booking-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        .status-confermata { 
            background: #d1fae5; 
            color: #065f46; 
            border: 1px solid #a7f3d0;
        }
        
        .status-pending { 
            background: #fef3c7; 
            color: #92400e; 
            border: 1px solid #fde68a;
        }
        
        .status-cancellata { 
            background: #fee2e2; 
            color: #991b1b; 
            border: 1px solid #fecaca;
        }
        
        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        @media (max-width: 767px) {
            .booking-details {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }
        
        .detail-value {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-success { background: #10b981; }
        .btn-warning { background: #f59e0b; }
        .btn-info { background: #3b82f6; }
        .btn-purple { background: #8b5cf6; }
        .btn-danger { background: #ef4444; }
        
        .floating-add {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        /* Form Styles */
        .form-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--secondary-color);
            color: var(--danger-color);
        }

        .search-bar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <svg width="80" height="80" viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg">
                        <path d="M50 180 Q100 120, 150 180 Q200 240, 250 180" fill="none" stroke="#64748b" stroke-width="25" opacity="0.8"/>
                        <path d="M10 60 Q60 10, 110 60 Q160 110, 210 60" fill="none" stroke="#64748b" stroke-width="20" opacity="0.7"/>
                        <circle cx="150" cy="100" r="65" fill="#64748b" opacity="0.9"/>
                        <circle cx="150" cy="100" r="45" fill="#22d3ee"/>
                        <g fill="white" stroke="none">
                            <path d="M125 85 L150 65 L175 85 Z"/>
                            <rect x="130" y="85" width="40" height="30"/>
                            <rect x="135" y="90" width="8" height="8" fill="#22d3ee"/>
                            <rect x="157" y="90" width="8" height="8" fill="#22d3ee"/>
                            <rect x="145" y="100" width="10" height="15" fill="#22d3ee"/>
                        </g>
                        <path d="M220 40 Q260 20, 280 60 Q290 100, 260 120" fill="none" stroke="#64748b" stroke-width="15" opacity="0.6"/>
                    </svg>
                    <div class="brand-text">
                        <div style="font-size: 2.8em; font-weight: 900; letter-spacing: 3px; line-height: 0.9; font-family: 'Arial Black', sans-serif;">QUIRINO</div>
                        <div style="font-size: 1.4em; font-weight: 300; letter-spacing: 6px; margin-top: 5px; opacity: 0.95; font-style: italic;">residence</div>
                    </div>
                </div>
            </div>
            <p style="position: relative; z-index: 2; font-size: 1.1em; margin-top: 10px;">Gestione professionale per Villa Nausicaa & Villa Atena</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">📊 Dashboard</button>
            <button class="nav-tab" onclick="switchTab('calendario')">📅 Calendario</button>
            <button class="nav-tab" onclick="switchTab('prenotazioni')">📋 Prenotazioni</button>
            <button class="nav-tab" onclick="switchTab('gestione')">⚙️ Gestione</button>
            <button class="nav-tab" onclick="switchTab('preventivi')">💰 Preventivi</button>
        </div>
        
        <!-- Tab Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Prenotazioni Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">€2,200</div>
                    <div class="stat-label">Ricavi Mese</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">75%</div>
                    <div class="stat-label">Tasso Occupazione</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">€2,100</div>
                    <div class="stat-label">Pagamenti Pendenti</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 20px; color: var(--text-primary);">📈 Prossime Prenotazioni</h3>
            <div class="booking-card" style="cursor: pointer;" onclick="alert('🎉 Dettagli prenotazione Mario Rossi')">
                <div class="booking-header">
                    <div class="booking-title">Mario e Anna Rossi</div>
                    <div class="booking-status status-confermata">Confermata</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                    <div class="detail-item">
                        <div class="detail-label">Villa</div>
                        <div class="detail-value">Villa Nausicaa</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Check-in</div>
                        <div class="detail-value">15/07/2025</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Ospiti</div>
                        <div class="detail-value">4</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Calendario -->
        <div id="calendario" class="tab-content">
            <div class="villa-selector">
                <button class="villa-btn active" onclick="selectVilla('nausicaa')">🏛️ Villa Nausicaa</button>
                <button class="villa-btn" onclick="selectVilla('atena')">🏛️ Villa Atena</button>
            </div>
            
            <div class="month-navigation">
                <button class="month-nav-btn" onclick="changeMonth(-1)">‹ Precedente</button>
                <div class="current-month">Luglio 2025</div>
                <button class="month-nav-btn" onclick="changeMonth(1)">Successivo ›</button>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ecfdf5; border-color: #bbf7d0;"></div>
                    <span>Disponibile</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fef2f2; border-color: #fecaca;"></div>
                    <span>Prenotato</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fffbeb; border-color: #fed7aa;"></div>
                    <span>In Attesa</span>
                </div>
            </div>
            
            <div class="calendar-container">
                <div class="calendar-header-row">
                    <div class="calendar-header">Lun</div>
                    <div class="calendar-header">Mar</div>
                    <div class="calendar-header">Mer</div>
                    <div class="calendar-header">Gio</div>
                    <div class="calendar-header">Ven</div>
                    <div class="calendar-header">Sab</div>
                    <div class="calendar-header">Dom</div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <div class="calendar-day other-month"><div class="day-number">30</div></div>
                    <div class="calendar-day available"><div class="day-number">1</div></div>
                    <div class="calendar-day available"><div class="day-number">2</div></div>
                    <div class="calendar-day available"><div class="day-number">3</div></div>
                    <div class="calendar-day available"><div class="day-number">4</div></div>
                    <div class="calendar-day available"><div class="day-number">5</div></div>
                    <div class="calendar-day available"><div class="day-number">6</div></div>
                    <div class="calendar-day available"><div class="day-number">7</div></div>
                    <div class="calendar-day available"><div class="day-number">8</div></div>
                    <div class="calendar-day available"><div class="day-number">9</div></div>
                    <div class="calendar-day available"><div class="day-number">10</div></div>
                    <div class="calendar-day available"><div class="day-number">11</div></div>
                    <div class="calendar-day available"><div class="day-number">12</div></div>
                    <div class="calendar-day available"><div class="day-number">13</div></div>
                    <div class="calendar-day available"><div class="day-number">14</div></div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi\n📞 Tel: +39 347 123 4567\n📧 mario.rossi@gmail.com')">
                        <div class="day-number">15</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (2° giorno)')">
                        <div class="day-number">16</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (3° giorno)')">
                        <div class="day-number">17</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (4° giorno)')">
                        <div class="day-number">18</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (5° giorno)')">
                        <div class="day-number">19</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (6° giorno)')">
                        <div class="day-number">20</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day booked" onclick="alert('📋 Prenotazione: Mario Rossi (7° giorno)')">
                        <div class="day-number">21</div>
                        <div class="booking-info">Mario</div>
                    </div>
                    <div class="calendar-day available"><div class="day-number">22</div></div>
                    <div class="calendar-day available"><div class="day-number">23</div></div>
                    <div class="calendar-day available"><div class="day-number">24</div></div>
                    <div class="calendar-day available"><div class="day-number">25</div></div>
                    <div class="calendar-day available"><div class="day-number">26</div></div>
                    <div class="calendar-day available"><div class="day-number">27</div></div>
                    <div class="calendar-day available"><div class="day-number">28</div></div>
                    <div class="calendar-day available"><div class="day-number">29</div></div>
                    <div class="calendar-day available"><div class="day-number">30</div></div>
                    <div class="calendar-day available"><div class="day-number">31</div></div>
                </div>
            </div>
        </div>
        
        <!-- Tab Prenotazioni -->
        <div id="prenotazioni" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                <h2 style="color: var(--text-primary); margin: 0;">📋 Gestione Prenotazioni</h2>
                <select style="padding: 8px 12px; border: 2px solid var(--border-color); border-radius: 8px;">
                    <option value="">Tutte le prenotazioni</option>
                    <option value="confermata">Solo confermate</option>
                    <option value="pending">Solo in attesa</option>
                </select>
            </div>
            
            <div class="bookings-list">
                <!-- Prenotazione 1 -->
                <div class="booking-card" data-booking-id="1">
                    <div class="booking-header">
                        <div class="booking-title">Mario e Anna Rossi - Villa Nausicaa</div>
                        <div class="booking-status status-confermata">Confermata</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-item">
                            <div class="detail-label">Periodo</div>
                            <div class="detail-value">15/07/2025 - 22/07/2025</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ospiti</div>
                            <div class="detail-value">4 persone</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">mario.rossi@gmail.com</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Telefono</div>
                            <div class="detail-value">+39 347 123 4567</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Prezzo Totale</div>
                            <div class="detail-value">€1,800</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Acconto</div>
                            <div class="detail-value">€900 (50%)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Canale</div>
                            <div class="detail-value">🏠 Airbnb</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="sendEmail('mario.rossi@gmail.com', 'conferma')">
                            ✉️ Conferma
                        </button>
                        <button class="btn btn-warning" onclick="sendEmail('mario.rossi@gmail.com', 'opzione')">
                            📝 Opzione
                        </button>
                        <button class="btn btn-info" onclick="sendEmail('mario.rossi@gmail.com', 'recensione')">
                            ⭐ Recensione
                        </button>
                        <button class="btn btn-purple" onclick="editBooking(1)">
                            ✏️ Modifica
                        </button>
                        <button class="btn btn-danger" onclick="deleteBooking(1, 'Mario e Anna Rossi')">
                            🗑️ Elimina
                        </button>
                    </div>
                </div>
                
                <!-- Prenotazione 2 -->
                <div class="booking-card" data-booking-id="2">
                    <div class="booking-header">
                        <div class="booking-title">Sarah Thompson - Villa Atena</div>
                        <div class="booking-status status-confermata">Confermata</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-item">
                            <div class="detail-label">Periodo</div>
                            <div class="detail-value">03/08/2025 - 10/08/2025</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ospiti</div>
                            <div class="detail-value">2 persone</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">sarah.thompson@outlook.com</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Telefono</div>
                            <div class="detail-value">+44 7912 345678</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Prezzo Totale</div>
                            <div class="detail-value">€1,400</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Acconto</div>
                            <div class="detail-value">€700 (50%)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Canale</div>
                            <div class="detail-value">🏨 Booking.com</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="sendEmail('sarah.thompson@outlook.com', 'conferma')">
                            ✉️ Conferma
                        </button>
                        <button class="btn btn-warning" onclick="sendEmail('sarah.thompson@outlook.com', 'opzione')">
                            📝 Opzione
                        </button>
                        <button class="btn btn-info" onclick="sendEmail('sarah.thompson@outlook.com', 'recensione')">
                            ⭐ Recensione
                        </button>
                        <button class="btn btn-purple" onclick="editBooking(2)">
                            ✏️ Modifica
                        </button>
                        <button class="btn btn-danger" onclick="deleteBooking(2, 'Sarah Thompson')">
                            🗑️ Elimina
                        </button>
                    </div>
                </div>
                
                <!-- Prenotazione 3 -->
                <div class="booking-card" data-booking-id="3">
                    <div class="booking-header">
                        <div class="booking-title">Jean-Pierre Dubois - Villa Nausicaa</div>
                        <div class="booking-status status-pending">In Attesa</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-item">
                            <div class="detail-label">Periodo</div>
                            <div class="detail-value">20/08/2025 - 27/08/2025</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ospiti</div>
                            <div class="detail-value">6 persone</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">jp.dubois@france.fr</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Telefono</div>
                            <div class="detail-value">+33 6 12 34 56 78</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Prezzo Totale</div>
                            <div class="detail-value">€2,100</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Acconto</div>
                            <div class="detail-value">€0 (Pendente)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Canale</div>
                            <div class="detail-value">📞 Diretto</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-warning" onclick="sendEmail('jp.dubois@france.fr', 'promemoria_preventivo')">
                            📧 Sollecito Acconto
                        </button>
                        <button class="btn btn-success" onclick="sendEmail('jp.dubois@france.fr', 'opzione')">
                            📝 Opzione
                        </button>
                        <button class="btn btn-purple" onclick="editBooking(3)">
                            ✏️ Modifica
                        </button>
                        <button class="btn btn-danger" onclick="deleteBooking(3, 'Jean-Pierre Dubois')">
                            🗑️ Elimina
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Gestione (NUOVO) -->
        <div id="gestione" class="tab-content">
            <h2 style="margin-bottom: 20px; color: var(--text-primary);">⚙️ Gestione Prenotazioni</h2>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="🔍 Cerca prenotazioni per nome, email o telefono..." id="searchInput" oninput="searchBookings()">
                <button class="btn btn-success" onclick="openBookingModal()">➕ Nuova Prenotazione</button>
            </div>

            <!-- Form Nuova/Modifica Prenotazione -->
            <div class="form-container">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;" id="formTitle">📝 Nuova Prenotazione</h3>
                
                <form id="bookingForm">
                    <input type="hidden" id="editingId" value="">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="nome">Nome Cliente *</label>
                            <input type="text" id="nome" class="form-input" placeholder="Mario Rossi" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="email">Email *</label>
                            <input type="email" id="email" class="form-input" placeholder="mario@email.com" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="telefono">Telefono *</label>
                            <input type="tel" id="telefono" class="form-input" placeholder="+39 123 456 7890" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="villa">Villa *</label>
                            <select id="villa" class="form-input" required>
                                <option value="">Seleziona Villa</option>
                                <option value="nausicaa">🏛️ Villa Nausicaa</option>
                                <option value="atena">🏛️ Villa Atena</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="checkin">Check-in *</label>
                            <input type="date" id="checkin" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="checkout">Check-out *</label>
                            <input type="date" id="checkout" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="ospiti">Numero Ospiti *</label>
                            <input type="number" id="ospiti" class="form-input" min="1" max="12" placeholder="4" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="prezzo">Prezzo Totale (€) *</label>
                            <input type="number" id="prezzo" class="form-input" step="0.01" placeholder="1500.00" required oninput="calculateBookingTotal()">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="acconto">Acconto Ricevuto (€)</label>
                            <input type="number" id="acconto" class="form-input" step="0.01" placeholder="750.00">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="canale">Canale di Prenotazione</label>
                            <select id="canale" class="form-input">
                                <option value="">Seleziona Canale</option>
                                <option value="airbnb">🏠 Airbnb</option>
                                <option value="booking">🏨 Booking.com</option>
                                <option value="expedia">✈️ Expedia</option>
                                <option value="diretto">📞 Diretto</option>
                                <option value="altro">📱 Altro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="stato">Stato Prenotazione *</label>
                            <select id="stato" class="form-input" required>
                                <option value="">Seleziona Stato</option>
                                <option value="confermata">✅ Confermata</option>
                                <option value="pending">⏳ In Attesa</option>
                                <option value="cancellata">❌ Cancellata</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="note">Note Aggiuntive</label>
                            <textarea id="note" class="form-input" rows="3" placeholder="Eventuali note o richieste speciali..."></textarea>
                        </div>
                    </div>
                    
                    <div id="bookingCalculation" style="background: var(--primary-color); color: white; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; font-weight: 700; display: none;">
                        <div>💰 Totale: €<span id="totalDisplay">0</span></div>
                        <div style="margin-top: 8px; font-size: 0.9em; opacity: 0.9;">
                            Acconto Consigliato (50%): €<span id="suggestedDeposit">0</span> | Saldo: €<span id="remainingBalance">0</span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn" style="background: var(--text-secondary);" onclick="resetBookingForm()">🔄 Reset</button>
                        <button type="submit" class="btn btn-success">💾 Salva Prenotazione</button>
                    </div>
                </form>
            </div>

            <!-- Lista Prenotazioni per Gestione -->
            <div style="margin-top: 40px;">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">📋 Prenotazioni Esistenti</h3>
                <div id="managementBookingsList" class="bookings-list">
                    <!-- Le prenotazioni verranno popolate dinamicamente -->
                </div>
            </div>
        </div>
        
        <!-- Tab Preventivi -->
        <div id="preventivi" class="tab-content">
            <h2 style="margin-bottom: 20px; color: var(--text-primary);">💰 Gestione Preventivi</h2>
            
            <div style="background: #f0fdf4; border: 2px solid #bbf7d0; border-radius: 12px; padding: 20px; margin: 20px 0;">
                <h3 style="color: #065f46; margin-bottom: 15px;">✨ Nuovo Preventivo</h3>
                <p style="color: #047857; margin-bottom: 20px;">Crea preventivi personalizzati con acconto del 50%</p>
                
                <div style="display: grid; gap: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Nome Cliente *</label>
                            <input type="text" id="prev-nome" placeholder="Mario Rossi" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email *</label>
                            <input type="email" id="prev-email" placeholder="mario@email.com" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Villa *</label>
                            <select id="prev-villa" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                                <option value="">Seleziona Villa</option>
                                <option value="nausicaa">🏛️ Villa Nausicaa</option>
                                <option value="atena">🏛️ Villa Atena</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Prezzo Totale (€) *</label>
                            <input type="number" id="prev-prezzo" placeholder="1500" step="0.01" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;" oninput="calculatePreventivo()">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Check-in *</label>
                            <input type="date" id="prev-checkin" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Check-out *</label>
                            <input type="date" id="prev-checkout" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Ospiti *</label>
                            <input type="number" id="prev-ospiti" min="1" max="12" placeholder="4" style="width: 100%; padding: 10px; border: 2px solid #d1fae5; border-radius: 6px;">
                        </div>
                    </div>
                    
                    <div id="preventivo-summary" style="background: #065f46; color: white; padding: 15px; border-radius: 8px; text-align: center; font-weight: 700; font-size: 1.1em; display: none;">
                        <div>💰 Totale Preventivo: €<span id="total-amount">0</span></div>
                        <div style="margin-top: 8px; font-size: 0.9em; opacity: 0.9;">
                            Acconto 50%: €<span id="deposit-amount">0</span> | Saldo: €<span id="balance-amount">0</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="sendPreventivo()" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600;">
                            📧 Invia Preventivo via Email
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 40px;">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">📋 Preventivi Inviati</h3>
                <div class="booking-card" style="border-left-color: #059669;">
                    <div class="booking-header">
                        <div class="booking-title">Preventivo #PV001 - Famiglia Bianchi</div>
                        <div class="booking-status" style="background: #d1fae5; color: #065f46;">In Attesa</div>
                    </div>
                    <div class="booking-details">
                        <div class="detail-item">
                            <div class="detail-label">Villa</div>
                            <div class="detail-value">Villa Nausicaa</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Periodo</div>
                            <div class="detail-value">10/08/2025 - 17/08/2025</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Totale</div>
                            <div class="detail-value">€1,650</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Acconto 50%</div>
                            <div class="detail-value">€825</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Inviato</div>
                            <div class="detail-value">14/06/2025</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-warning" onclick="sendEmail('bianchi@email.com', 'promemoria_preventivo')">
                            📧 Sollecito
                        </button>
                        <button class="btn btn-success" onclick="alert('✅ Conversione preventivo in prenotazione...')">
                            ✅ Converti in Prenotazione
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-add" onclick="switchToGestioneAndOpenForm()" title="Nuova Prenotazione">+</button>

    <!-- Modal di Conferma Cancellazione -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--danger-color); margin: 0;">🗑️ Conferma Cancellazione</h2>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 3em; margin-bottom: 15px;">⚠️</div>
                <p style="font-size: 1.1em; margin-bottom: 20px; color: var(--text-primary);">
                    Sei sicuro di voler eliminare la prenotazione di <strong id="deleteBookingName"></strong>?
                </p>
                <p style="color: var(--danger-color); font-weight: 600; margin-bottom: 30px;">
                    ⚠️ Questa azione non può essere annullata!
                </p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn" style="background: var(--text-secondary);" onclick="closeDeleteModal()">
                        ❌ Annulla
                    </button>
                    <button class="btn btn-danger" onclick="confirmDelete()">
                        🗑️ Elimina Definitivamente
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('🚀 Inizializzazione Quirino Residence Manager Enhanced...');
        
        // Variabili globali
        let currentEditingId = null;
        let bookingToDelete = null;
        let bookings = [
            {
                id: 1,
                nome: "Mario e Anna Rossi",
                email: "mario.rossi@gmail.com",
                telefono: "+39 347 123 4567",
                villa: "nausicaa",
                checkin: "2025-07-15",
                checkout: "2025-07-22",
                ospiti: 4,
                prezzo: 1800,
                acconto: 900,
                canale: "airbnb",
                stato: "confermata",
                note: ""
            },
            {
                id: 2,
                nome: "Sarah Thompson",
                email: "sarah.thompson@outlook.com",
                telefono: "+44 7912 345678",
                villa: "atena",
                checkin: "2025-08-03",
                checkout: "2025-08-10",
                ospiti: 2,
                prezzo: 1400,
                acconto: 700,
                canale: "booking",
                stato: "confermata",
                note: ""
            },
            {
                id: 3,
                nome: "Jean-Pierre Dubois",
                email: "jp.dubois@france.fr",
                telefono: "+33 6 12 34 56 78",
                villa: "nausicaa",
                checkin: "2025-08-20",
                checkout: "2025-08-27",
                ospiti: 6,
                prezzo: 2100,
                acconto: 0,
                canale: "diretto",
                stato: "pending",
                note: "Richiesta speciale: late checkout"
            }
        ];
        
        // Funzione per cambiare tab
        function switchTab(tabName) {
            console.log('📂 Switching to tab:', tabName);
            
            // Rimuove classe active da tutte le tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Attiva la tab selezionata
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('✅ Tab attivata:', tabName);
                
                // Se è la tab gestione, aggiorna la lista
                if (tabName === 'gestione') {
                    renderManagementBookings();
                }
            } else {
                console.error('❌ Tab non trovata:', tabName);
            }
            
            // Trova e attiva il nav-tab corrispondente
            const navTabs = document.querySelectorAll('.nav-tab');
            const tabIds = ['dashboard', 'calendario', 'prenotazioni', 'gestione', 'preventivi'];
            const index = tabIds.indexOf(tabName);
            if (index !== -1 && navTabs[index]) {
                navTabs[index].classList.add('active');
            }
        }
        
        // Funzione per passare alla tab gestione e aprire il form
        function switchToGestioneAndOpenForm() {
            switchTab('gestione');
            resetBookingForm();
        }
        
        // Funzione per calcolare il totale della prenotazione
        function calculateBookingTotal() {
            const prezzo = parseFloat(document.getElementById('prezzo').value) || 0;
            
            if (prezzo > 0) {
                const accontoConsigliato = prezzo * 0.5;
                const acconto = parseFloat(document.getElementById('acconto').value) || 0;
                const saldo = prezzo - acconto;
                
                document.getElementById('totalDisplay').textContent = prezzo.toFixed(2);
                document.getElementById('suggestedDeposit').textContent = accontoConsigliato.toFixed(2);
                document.getElementById('remainingBalance').textContent = saldo.toFixed(2);
                document.getElementById('bookingCalculation').style.display = 'block';
            } else {
                document.getElementById('bookingCalculation').style.display = 'none';
            }
        }
        
        // Funzione per resettare il form
        function resetBookingForm() {
            document.getElementById('bookingForm').reset();
            document.getElementById('editingId').value = '';
            document.getElementById('formTitle').textContent = '📝 Nuova Prenotazione';
            document.getElementById('bookingCalculation').style.display = 'none';
            currentEditingId = null;
        }
        
        // Funzione per aprire il modal di prenotazione
        function openBookingModal() {
            resetBookingForm();
            // Per ora usa il form nella pagina, in futuro si può creare un modal
            document.getElementById('nome').focus();
        }
        
        // Funzione per salvare/aggiornare prenotazione
        function saveBooking(event) {
            event.preventDefault();
            
            const formData = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                telefono: document.getElementById('telefono').value,
                villa: document.getElementById('villa').value,
                checkin: document.getElementById('checkin').value,
                checkout: document.getElementById('checkout').value,
                ospiti: parseInt(document.getElementById('ospiti').value),
                prezzo: parseFloat(document.getElementById('prezzo').value),
                acconto: parseFloat(document.getElementById('acconto').value) || 0,
                canale: document.getElementById('canale').value,
                stato: document.getElementById('stato').value,
                note: document.getElementById('note').value
            };
            
            // Validazione base
            if (!formData.nome || !formData.email || !formData.telefono || !formData.villa || 
                !formData.checkin || !formData.checkout || !formData.ospiti || !formData.prezzo || !formData.stato) {
                alert('❌ Compila tutti i campi obbligatori!');
                return;
            }
            
            // Validazione date
            const checkinDate = new Date(formData.checkin);
            const checkoutDate = new Date(formData.checkout);
            if (checkoutDate <= checkinDate) {
                alert('❌ La data di check-out deve essere successiva al check-in!');
                return;
            }
            
            if (currentEditingId) {
                // Modifica prenotazione esistente
                const index = bookings.findIndex(b => b.id === currentEditingId);
                if (index !== -1) {
                    bookings[index] = { ...formData, id: currentEditingId };
                    showAlert('success', `✅ Prenotazione di ${formData.nome} aggiornata con successo!`);
                }
            } else {
                // Nuova prenotazione
                const newId = Math.max(...bookings.map(b => b.id)) + 1;
                bookings.push({ ...formData, id: newId });
                showAlert('success', `✅ Nuova prenotazione creata per ${formData.nome}!`);
            }
            
            resetBookingForm();
            renderManagementBookings();
        }
        
        // Funzione per modificare una prenotazione
        function editBooking(bookingId) {
            const booking = bookings.find(b => b.id === bookingId);
            if (!booking) {
                alert('❌ Prenotazione non trovata!');
                return;
            }
            
            // Passa alla tab gestione
            switchTab('gestione');
            
            // Popola il form
            currentEditingId = bookingId;
            document.getElementById('editingId').value = bookingId;
            document.getElementById('formTitle').textContent = `✏️ Modifica Prenotazione - ${booking.nome}`;
            
            document.getElementById('nome').value = booking.nome;
            document.getElementById('email').value = booking.email;
            document.getElementById('telefono').value = booking.telefono;
            document.getElementById('villa').value = booking.villa;
            document.getElementById('checkin').value = booking.checkin;
            document.getElementById('checkout').value = booking.checkout;
            document.getElementById('ospiti').value = booking.ospiti;
            document.getElementById('prezzo').value = booking.prezzo;
            document.getElementById('acconto').value = booking.acconto;
            document.getElementById('canale').value = booking.canale;
            document.getElementById('stato').value = booking.stato;
            document.getElementById('note').value = booking.note || '';
            
            calculateBookingTotal();
            
            // Scroll to form
            document.getElementById('bookingForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Funzione per eliminare una prenotazione
        function deleteBooking(bookingId, bookingName) {
            bookingToDelete = bookingId;
            document.getElementById('deleteBookingName').textContent = bookingName;
            document.getElementById('deleteModal').style.display = 'block';
        }
        
        // Funzione per confermare l'eliminazione
        function confirmDelete() {
            if (bookingToDelete) {
                const index = bookings.findIndex(b => b.id === bookingToDelete);
                if (index !== -1) {
                    const deletedBooking = bookings[index];
                    bookings.splice(index, 1);
                    showAlert('success', `🗑️ Prenotazione di ${deletedBooking.nome} eliminata!`);
                    renderManagementBookings();
                }
            }
            closeDeleteModal();
        }
        
        // Funzione per chiudere il modal di cancellazione
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            bookingToDelete = null;
        }
        
        // Funzione per cercare prenotazioni
        function searchBookings() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredBookings = bookings.filter(booking => 
                booking.nome.toLowerCase().includes(searchTerm) ||
                booking.email.toLowerCase().includes(searchTerm) ||
                booking.telefono.toLowerCase().includes(searchTerm)
            );
            renderManagementBookings(filteredBookings);
        }
        
        // Funzione per renderizzare le prenotazioni nella tab gestione
        function renderManagementBookings(bookingsToRender = bookings) {
            const container = document.getElementById('managementBookingsList');
            
            if (bookingsToRender.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 3em; margin-bottom: 15px;">📭</div>
                        <h3>Nessuna prenotazione trovata</h3>
                        <p>Non ci sono prenotazioni che corrispondono ai criteri di ricerca.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = bookingsToRender.map(booking => {
                const villaName = booking.villa === 'nausicaa' ? 'Villa Nausicaa' : 'Villa Atena';
                const canaleIcon = {
                    'airbnb': '🏠',
                    'booking': '🏨',
                    'expedia': '✈️',
                    'diretto': '📞',
                    'altro': '📱'
                };
                const statusClass = {
                    'confermata': 'status-confermata',
                    'pending': 'status-pending',
                    'cancellata': 'status-cancellata'
                };
                const statusText = {
                    'confermata': 'Confermata',
                    'pending': 'In Attesa',
                    'cancellata': 'Cancellata'
                };
                
                return `
                    <div class="booking-card" data-booking-id="${booking.id}">
                        <div class="booking-header">
                            <div class="booking-title">${booking.nome} - ${villaName}</div>
                            <div class="booking-status ${statusClass[booking.stato]}">${statusText[booking.stato]}</div>
                        </div>
                        <div class="booking-details">
                            <div class="detail-item">
                                <div class="detail-label">Periodo</div>
                                <div class="detail-value">${formatDate(booking.checkin)} - ${formatDate(booking.checkout)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Ospiti</div>
                                <div class="detail-value">${booking.ospiti} persone</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Email</div>
                                <div class="detail-value">${booking.email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Telefono</div>
                                <div class="detail-value">${booking.telefono}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Prezzo Totale</div>
                                <div class="detail-value">€${booking.prezzo.toFixed(2)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Acconto</div>
                                <div class="detail-value">€${booking.acconto.toFixed(2)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Saldo</div>
                                <div class="detail-value">€${(booking.prezzo - booking.acconto).toFixed(2)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Canale</div>
                                <div class="detail-value">${canaleIcon[booking.canale] || '📱'} ${booking.canale.charAt(0).toUpperCase() + booking.canale.slice(1)}</div>
                            </div>
                        </div>
                        ${booking.note ? `
                            <div style="margin-top: 15px; padding: 10px; background: var(--secondary-color); border-radius: 8px;">
                                <div class="detail-label">Note</div>
                                <div class="detail-value">${booking.note}</div>
                            </div>
                        ` : ''}
                        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="sendEmail('${booking.email}', 'conferma')">
                                ✉️ Email Conferma
                            </button>
                            <button class="btn btn-purple" onclick="editBooking(${booking.id})">
                                ✏️ Modifica
                            </button>
                            <button class="btn btn-danger" onclick="deleteBooking(${booking.id}, '${booking.nome}')">
                                🗑️ Elimina
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Funzione per mostrare alert
        function showAlert(type, message) {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'warning' ? 'alert-warning' : 'alert-danger';
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('#gestione .form-container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        // Funzione per formattare le date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('it-IT');
        }
        
        // Funzione per selezionare villa
        function selectVilla(villa) {
            console.log('🏛️ Villa selezionata:', villa);
            document.querySelectorAll('.villa-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const buttons = document.querySelectorAll('.villa-btn');
            buttons.forEach(btn => {
                if ((villa === 'nausicaa' && btn.textContent.includes('Nausicaa')) || 
                    (villa === 'atena' && btn.textContent.includes('Atena'))) {
                    btn.classList.add('active');
                }
            });
            
            alert(`🏛️ Calendario aggiornato per ${villa === 'nausicaa' ? 'Villa Nausicaa' : 'Villa Atena'}`);
        }
        
        // Funzione per navigazione mesi
        function changeMonth(direction) {
            const currentMonth = document.querySelector('.current-month');
            if (direction === 1) {
                currentMonth.textContent = 'Agosto 2025';
                alert('📅 Passaggio ad Agosto 2025');
            } else {
                currentMonth.textContent = 'Giugno 2025';
                alert('📅 Passaggio a Giugno 2025');
            }
        }
        
        // Funzione per calcolare preventivo
        function calculatePreventivo() {
            const prezzo = parseFloat(document.getElementById('prev-prezzo').value) || 0;
            
            if (prezzo > 0) {
                const acconto = prezzo * 0.5;
                const saldo = prezzo - acconto;
                
                document.getElementById('total-amount').textContent = prezzo.toFixed(2);
                document.getElementById('deposit-amount').textContent = acconto.toFixed(2);
                document.getElementById('balance-amount').textContent = saldo.toFixed(2);
                document.getElementById('preventivo-summary').style.display = 'block';
            } else {
                document.getElementById('preventivo-summary').style.display = 'none';
            }
        }
        
        // Funzione per inviare preventivo
        function sendPreventivo() {
            const nome = document.getElementById('prev-nome').value;
            const email = document.getElementById('prev-email').value;
            const villa = document.getElementById('prev-villa').value;
            const prezzo = document.getElementById('prev-prezzo').value;
            const checkin = document.getElementById('prev-checkin').value;
            const checkout = document.getElementById('prev-checkout').value;
            const ospiti = document.getElementById('prev-ospiti').value;
            
            if (!nome || !email || !villa || !prezzo || !checkin || !checkout || !ospiti) {
                alert('❌ Compila tutti i campi obbligatori!');
                return;
            }
            
            const acconto = (parseFloat(prezzo) * 0.5).toFixed(2);
            const now = new Date();
            const codicePreventivo = `PV${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
            
            const oggetto = `Preventivo ${codicePreventivo} - ${villa === 'nausicaa' ? 'Villa Nausicaa' : 'Villa Atena'} - Quirino Residence`;
            
            const corpo = `Gentile ${nome},

siamo lieti di inviarle il preventivo richiesto per il soggiorno presso ${villa === 'nausicaa' ? 'Villa Nausicaa' : 'Villa Atena'}:

📅 PERIODO: ${checkin} - ${checkout}
👥 OSPITI: ${ospiti}
📄 CODICE PREVENTIVO: ${codicePreventivo}

💰 DETTAGLIO COSTI:
• Soggiorno ${ospiti} ospiti: €${prezzo}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💵 TOTALE: €${prezzo}

📋 CONDIZIONI:
• Preventivo valido 15 giorni dalla data di emissione
• Acconto del 50% alla conferma (€${acconto})
• Saldo entro il giorno di arrivo
• Check-in: dalle 15:00 alle 19:00
• Check-out: entro le 10:00
• Pulizia finale inclusa
• Lenzuola e asciugamani inclusi
• 1 posto auto privato incluso

🏦 MODALITÀ PAGAMENTO:
• Bonifico bancario: IBAN IT40W0364601600526509298002
• PostePay: 5333171157144920
• Intestato a: CAPOTOSTO GIUSEPPE
• Causale: ${nome} - ${codicePreventivo}

Per confermare la prenotazione è sufficiente versare l'acconto di €${acconto} e comunicarci gli estremi del pagamento.

Restiamo a disposizione per qualsiasi chiarimento!

Cordiali saluti,
Giuseppe e Francesca

QUIRINO RESIDENCE
Tel: 329.9322748
Email: info@quirinoresidence.it`;
            
            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(oggetto)}&body=${encodeURIComponent(corpo)}`;
            window.location.href = mailtoLink;
            
            alert(`📧 Preventivo ${codicePreventivo} inviato a ${email}!\n\n💰 Totale: €${prezzo}\n🏦 Acconto 50%: €${acconto}`);
            
            // Reset form
            document.getElementById('prev-nome').value = '';
            document.getElementById('prev-email').value = '';
            document.getElementById('prev-villa').value = '';
            document.getElementById('prev-prezzo').value = '';
            document.getElementById('prev-checkin').value = '';
            document.getElementById('prev-checkout').value = '';
            document.getElementById('prev-ospiti').value = '';
            document.getElementById('preventivo-summary').style.display = 'none';
        }
        
        // Funzione per inviare email
        function sendEmail(email, tipo) {
            let oggetto = '';
            let corpo = '';
            
            switch(tipo) {
                case 'conferma':
                    oggetto = 'Conferma Prenotazione - Quirino Residence';
                    corpo = `Gentile Cliente,

con le presente abbiamo il piacere di confermarvi la prenotazione presso la nostra struttura.

Ricordiamo che il check in può essere fatto dopo le ore 15.00 del giorno di arrivo, e il check out entro le 10.00 del giorno di partenza.

In attesa di potervi dare personalmente il nostro benvenuto,
Vi inviamo i nostri più cordiali saluti

***Quirino Residence***`;
                    break;
                    
                case 'opzione':
                    oggetto = 'Opzione Prenotazione - Quirino Residence';
                    corpo = `Spett.le Cliente,

grazie per averci scelti! La presente è per confermarle l'opzione di prenotazione.

La prenotazione è da considerarsi valida al ricevimento della caparra confirmatoria del 50%.

Coordinate bancarie:
IBAN: IT40W0364601600526509298002
INTESTATO A: CAPOTOSTO GIUSEPPE

Cordialmente
QUIRINO RESIDENCE 329.9322748`;
                    break;
                    
                case 'recensione':
                    oggetto = 'Grazie per il vostro soggiorno - Quirino Residence';
                    corpo = `Ciao,

ti ringraziamo sentitamente per aver scelto Quirino Residence per il tuo soggiorno a Gaeta.

Ti chiediamo di dedicarci qualche minuto per una recensione online. Per te significa solo un minuto, per noi ha un valore inestimabile!

Sconto 10% per il prossimo soggiorno con coupon "FEEDBACK10"

Grazie di cuore!
Giuseppe e Francesca
QUIRINO RESIDENCE`;
                    break;
                    
                case 'promemoria_preventivo':
                    oggetto = 'Promemoria Preventivo - Quirino Residence';
                    corpo = `Gentile Cliente,

le ricordiamo che ha ricevuto il nostro preventivo.

Per confermare la prenotazione versi l'acconto del 50% e ci comunichi l'avvenuto pagamento.

Coordinate:
IBAN: IT40W0364601600526509298002
INTESTATO: CAPOTOSTO GIUSEPPE

Cordiali saluti,
QUIRINO RESIDENCE 329.9322748`;
                    break;
            }
            
            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(oggetto)}&body=${encodeURIComponent(corpo)}`;
            window.location.href = mailtoLink;
            
            alert(`📧 Email "${tipo}" inviata a ${email}!`);
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Quirino Residence Manager Enhanced caricato!');
            
            // Aggiungi event listener al form
            document.getElementById('bookingForm').addEventListener('submit', saveBooking);
            
            // Imposta date minime
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkin').setAttribute('min', today);
            document.getElementById('checkout').setAttribute('min', today);
            document.getElementById('prev-checkin').setAttribute('min', today);
            document.getElementById('prev-checkout').setAttribute('min', today);
            
            // Aggiorna checkout quando cambia checkin
            document.getElementById('checkin').addEventListener('change', function() {
                const checkinDate = new Date(this.value);
                checkinDate.setDate(checkinDate.getDate() + 1);
                document.getElementById('checkout').setAttribute('min', checkinDate.toISOString().split('T')[0]);
            });
            
            renderManagementBookings();
        });
        
        // Chiudi modal cliccando fuori
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('deleteModal');
            if (event.target === modal) {
                closeDeleteModal();
            }
        });
        
        console.log('✅ Script Enhanced caricato - Tutte le funzioni disponibili!');
    </script>
</body>
</html>
